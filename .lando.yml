name: challenge-app
recipe: drupal11
config:
  webroot: web
  php: '8.3'
  database: postgres:16
  via: nginx

services:
  database:
    type: postgres:16
    portforward: 5432
    creds:
      user: challenge
      password: challenge
      database: challenge
    cache:
      type: redis:7
      portforward: 6379
  appserver:
    build_as_root:
      - apt-get update -y
      - apt-get install -y unzip
      - curl -sS https://getcomposer.org/installer | php
      - mv composer.phar /usr/local/bin/composer

proxy:
  appserver_nginx:
    - challenge.lndo.site

tooling:
  php:
    service: appserver
  composer:
    service: appserver
  drush:
    service: appserver
  psql:
    service: database
  redis-cli:
    service: cache